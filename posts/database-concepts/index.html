<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Database Concepts | Bits of Experience</title>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://marcohassan.github.io/bits-of-experience/posts/database-concepts/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Marco Hassan">
<link rel="prev" href="../java-notes-history-syntax-and-tricks/" title="Java Notes - History, Syntax and Tricks" type="text/html">
<link rel="next" href="../emacs-as-java-ide-via-lsp/" title="Emacs as Java IDE via LSP" type="text/html">
<meta property="og:site_name" content="Bits of Experience">
<meta property="og:title" content="Database Concepts">
<meta property="og:url" content="https://marcohassan.github.io/bits-of-experience/posts/database-concepts/">
<meta property="og:description" content="img {
display: block;
margin-top: 60px;
margin-bottom: 60px;
margin-left: auto;
margin-right: auto;
width: 70%;
height: 100%;
class: center;
}

.container {
  position: relative;
  left: 15%;
  margin">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-09-18T17:11:47+01:00">
</head>
<body>
    <a href="#page-content" class="sr-only sr-only-focusable">Skip to main content</a>
    
    <section class="social"><ul>
<li><a href="../../pages/aboutme/" title="About me"><i class="fa fa-user-circle"></i></a></li>
            <li><a href="../../pages/bits-of-experience-a-readable-view-on-my-study-adventures/" title="Home"><i class="fa fa-home"></i></a></li>
            <li><a href="../../index.html" title="Blog"><i class="fa fa-edit"></i></a></li>
            <li><a href="../../pages/emacs/" title="A life Configuring Emacs"><i class="fa fa-code"></i></a></li>
            <li><a href="../../pages/papers/" title="Term and Research Papers"><i class="fa fa-university"></i></a></li>
            <li><a href="../../pages/foto-blog/" title="Foto Blog"><i class="fa fa-camera-retro"></i></a></li>
            <li><a href="https://github.com/MarcoHassan" title="My Github"><i class="fab fa-github"></i></a></li>
            <li><a href="https://stackoverflow.com/users/9731177/mhass" title="My Stack"><i class="fab fa-stack-overflow"></i></a></li>
            <li><a href="../../rss.xml" title="RSS"><i class="fa fa-rss"></i></a></li>
            <li><a href="../../categories/index.html" title="Tags"><i class="fa fa-tags"></i></a></li>
    
    

        </ul></section><section class="page-content"><div class="content" rel="main">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Database Concepts</a></h1>

        <div class="metadata">
            <p class="dateline"><a href="." rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2021-09-18T17:11:47+01:00" itemprop="datePublished" title="2021-09-18 17:11">2021-09-18 17:11</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                    Marco Hassan
            </span></p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink"><i class="fa fa-file-code"></i> Source</a></p>

            

            

        </div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <style>
img {
display: block;
margin-top: 60px;
margin-bottom: 60px;
margin-left: auto;
margin-right: auto;
width: 70%;
height: 100%;
class: center;
}

.container {
  position: relative;
  left: 15%;
  margin-top: 60px;
  margin-bottom: 60px;
  width: 70%;
  overflow: hidden;
  padding-top: 56.25%; /* 16:9 Aspect Ratio */
  display:block;
  overflow-y: hidden;
}

.responsive-iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border: none;
  display:block;
  overflow-y: hidden;
}
</style>
<p>
So in my new job role there is gonna be quite some SQL so here some
notes on some important DB concepts.
</p>

<p>
Time to refresh, since in the last of couple of years your focus was
not on pure SQL.
</p>

<!-- TEASER_END -->


<div id="outline-container-orgeebd326" class="outline-2">
<h2 id="orgeebd326">Datbase Partitioning</h2>
<div class="outline-text-2" id="text-orgeebd326">
<p>
This sections notes are based on: <a href="https://www.digitalocean.com/community/tutorials/understanding-database-sharding">this</a>.
</p>

<p>
In the vertical partition you split by column. In horizontal you
have different tables with the same schema saved over different
instances. So your database is in fact distributed.
</p>

<img src="../../images/db_partitioning.png" class="center">
</div>

<div id="outline-container-orgd45fe1c" class="outline-3">
<h3 id="orgd45fe1c">Database Sharding</h3>
<div class="outline-text-3" id="text-orgd45fe1c">
<p>
Basically as mentioned this is <i>horizontal partitioning</i>.
</p>

<p>
Database shards exemplify a shared-nothing architecture. This means
that the shards are autonomous; they don’t share any of the same data
or computing resources.
</p>

<p>
Oftentimes, sharding is implemented at the <b>application level</b>,
meaning that the application includes code that defines which shard
to transmit reads and writes to. However, some database management
systems have sharding capabilities built in, allowing you to
<i>implement sharding directly at the database level</i>.
</p>

<p>
Note the following <b>reasons for sharding</b>:
</p>

<p>
First and foremost you scale out with it. This is essentially the
idea of the Big Data frameworks that you saw in your multiple
classes at University time. 
</p>

<blockquote>
<p>
Another reason why some might choose a sharded database architecture
is to <b>speed up query response times</b>. When you submit a query on a
database that hasn’t been sharded, it may have to search every row in
the table you’re querying before it can find the result set you’re
looking for. For an application with a large, monolithic database,
queries can become prohibitively slow. By sharding one table into
multiple, though, queries have to go over fewer rows and their result
sets are returned much more quickly.
</p>
</blockquote>

<p>
As a final reason the article mentions this one:
</p>

<blockquote>
<p>
Sharding can also help to make an application more reliable by
mitigating the impact of outages. If your application or website
relies on an unsharded database, an outage has the potential to make
the entire application unavailable. With a sharded database, though,
an outage is likely to affect only a single shard. Even though this
might make some parts of the application or website unavailable to
some users, the overall impact would still be less than if the entire
database crashed.
</p>
</blockquote>

<p>
I mean to be honest I think there are more elegant solutions for
the above. It is a bit a forced point but I list it nonetheless in
here.
</p>

<p>
Note that there are as well quite some concepts as mentioned on the
referred source above that speaks counter the sharding idea.
</p>

<p>
Then for instance one classical sharding possibility is the
following:
</p>

<img src="../../images/db_key_sharding.png" class="center"><p>
Note that the above is just one possibility among the many sharding
possibilities.
</p>
</div>
</div>
</div>


<div id="outline-container-orgbf2d0d9" class="outline-2">
<h2 id="orgbf2d0d9">Linked Servers</h2>
<div class="outline-text-2" id="text-orgbf2d0d9">
<p>
These enable you to implement distributed databases that can fetch
and update data in other databases.
</p>

<p>
They are for instance a good solution in the scenarios where you
need to implement database sharding without need to create a custom
application code or directly load from remote data sources.
</p>

<p>
So basically with them you can do the following:
</p>

<ul class="org-ul">
<li>The ability to access data from outside of SQL Server</li>

<li>
<p>
The ability to issue distributed queries, updates, commands, and
transactions on heterogeneous data sources across the enterprise.
</p>

<p>
Think for instance again to the case of sharding. 
</p>
</li>
</ul>
<p>
Note that the reason why we use this solution as a team is different
but this is another discussion I will not dig too much into.
</p>

<p>
Basically the way you implment this architecture is then the
following:
</p>


<img src="../../images/linked_server.png" class="center">
</div>
</div>


<div id="outline-container-orge257d5f" class="outline-2">
<h2 id="orge257d5f">Data Dictionary</h2>
<div class="outline-text-2" id="text-orge257d5f">
<p>
A data dictionary, or metadata repository, as defined in the IBM
Dictionary of Computing, is a "centralized repository of information
about data such as meaning, relationships to other data, origin,
usage, and format".
</p>

<p>
The term can have one of several closely related meanings pertaining
to databases and database management systems (DBMS):
</p>

<ul class="org-ul">
<li>A document describing a database or collection of databases</li>

<li>An integral component of a DBMS that is required to determine its
structure</li>

<li>A piece of middleware that extends or supplants the native data
dictionary of a DBMS. This is the one I am reffering to in my notes.</li>
</ul>
</div>
</div>


<div id="outline-container-org74c51c1" class="outline-2">
<h2 id="org74c51c1">Table Views</h2>
<div class="outline-text-2" id="text-org74c51c1">
<p>
This is a powerful concepts.
</p>

<p>
The wikipedia definition for it is sufficient to get a basic
understanding of what <i>views</i> are:
</p>

<blockquote>
<p>
A view is the result set of a stored query on the data, which the
database users can query just as they would in a persistent database
collection object.
</p>

<p>
This pre-established query command is kept in the database
dictionary.
</p>

<p>
Unlike ordinary base tables in a relational database, a view does
not form part of the physical schema: as a result set, <b>it is a
virtual table computed or collated dynamically</b> <b>from data in the
database when access to that view is requested</b>. Changes applied to
the data in a relevant underlying table are reflected in the data
shown in subsequent invocations of the view
</p>
</blockquote>

<p>
Views are helpful in the follwoing cases:
</p>

<ul class="org-ul">
<li>can represent a subset of data. can be used for access
permissions. You expose a <i>view</i> to some user without exposing the
entire database.</li>

<li>views can <b>join</b> and simplify <b>multiple tables</b> into a single
virtual table. (note that though the performance will likely still
suffer from the burden of computing the joins each time one of the
underlying queries changes)</li>

<li>you can hide some complexity using views such that is useful for
some other person of your team to work with.</li>

<li>views just take very little space to store. the DB just contains
the definiton of a view and not a copy of all the data that it
presents.</li>
</ul>
<p>
<b>Note</b> that in a similar way to the programming concepts you can
<b>nest</b> views such that you can <i>a view</i> aggregating the information
from multiple views.
</p>


<p>
<b>Note a table is a set:</b> A view is a relational table, and the
relational model defines a table as a set of rows. Since sets are
not ordered — by definition — neither are the rows of a
view. Therefore, an <code>ORDER BY</code> clause in the view definition is
meaningless.
</p>
</div>
</div>



<div id="outline-container-org3e5b4da" class="outline-2">
<h2 id="org3e5b4da">Stored Procedures</h2>
<div class="outline-text-2" id="text-org3e5b4da">
<p>
So that is probably the big discussion in my larger team.
</p>

<p>
The question is if to keep the business logic into the application
code or into sql-queries.
</p>

<p>
I always embedded my business logic at the application layer
performing the necessary data withdrawl and transformation steps at
the application layer.
</p>

<p>
There is the tendency in my team to use a different approach and to
<i>store the business logic into stored procedures</i>. I am too fresh
into the entire systems of my team to take an informed about the
topic.
</p>

<p>
So develop on this and explore the topic further until you can take
an informed position about the topic.
</p>

<p>
Starting with the basic 15 min. research the following picture
emerge.
</p>

<p>
Stored procedures are essentially SQL statements that are saved in
the database <i>data dictionary</i>. You can pass parameters to your
stored procedures. Such parameters will be passed by the client
triggering a stored procedure. It is therefore possible to expose
some business logic in a flexible way through them. 
</p>

<p>
<b>Note</b> that they do not have to return a table (set of rows) or a
value as in the case of functions and there is in this sense a
difference between the two. You can for instance perform CRUD
operations via stored procedures.
</p>

<p>
Now the arguments that I am reading around in favour of stored
procedures are the following:
</p>

<ol class="org-ol">
<li>
<p>
It can be <b>easily modified</b>: We can easily modify the code inside
the stored procedure without the need to restart or deploying the
application. For example, if the SQL queries are written in the
application and if we need to change the logic, we must change
the code in the application and re-deploy it.
</p>

<p>
That is true for compiled languages and not for scripting
languages. There there is no big difference as I usually develop
keeping a runtime open where I do my on the fly development
running the application logic of interest.
</p>

<p>
Moreover, this sounds like a little benefit to justify the usage
of such stored procedures. 
</p>
</li>

<li>
<p>
<b>Reduceded Network Traffic</b>: A major advantage of stored
procedures is that they can run directly within the database
engine. They are in fact <b>stored on the DB</b> and from there the
database engine executes them.
</p>

<p>
In a production system, this typically means that the procedures
run entirely on a specialized database server, which has <i>direct
access to the data being accessed</i>. You just ship your parameters
and that is it. The benefit here is that network communication costs can be
avoided completely. <b>This becomes more important for complex
series of SQL statements</b>.
</p>

<p>
As if you have to traffic all of the SQL results back and
forth, make transformations and then run other queries based on
that you see that you quickly get a huge amount of traffic and
everything becomes messy.
</p>

<p>
<i>My Comment:</i> I do see the argument. I am not sure that it is
really the definitive solution. As you are running SQL statements
theoretically you can ship the very same SQL statement via the
application and you can do that in 1 shot so if you structure
things properly you should be able to keep your network bandwidth
safe. 
</p>
</li>

<li>
<p>
<b>Centralized business logic</b>: this point follows directly from
the above. To see this consider the follwoing wording above:
</p>

<p>
<i>They are in fact <b>stored on the DB</b> and from there the database
engine executes them.</i>
</p>

<p>
So this means that you have no chance of having a curropted
client-program logic that was not properly managed across your
software development teams. There is a single source of truth for
the business logic and that reside at the database location.
</p>

<p>
<i>My comment:</i> The strongest argument for me. Probably the one and
only that makes really sense and the ultimate reason for stored
procedures.
</p>

<p>
<i>Note:</i> I even read the following as advantage.
</p>

<blockquote>
<p>
The database system can ensure data integrity and consistency
with the help of stored procedures.
</p>
</blockquote>

<p>
<i>My comment:</i> I think that is very important. Would need some more detailed
explaination of how that would be exactly implemented to make
sense of it in a real way.
</p>
</li>

<li>
<b>Delegating access-rights</b>: In many systems, stored procedures can
be granted access rights to the database that users who execute
those procedures do not directly have.</li>

<li>
<b>Performance:</b> Because stored procedure statements are stored
directly in the database, they may remove all or part of the
compiling overhead that is typically needed in situations where
software applications send inline (dynamic) SQL queries to a
database. (However, most database systems implement statement
caches and other methods to avoid repetitively compiling dynamic
SQL statements.) Also, while they avoid some pre-compiled SQL,
statements add to the complexity of creating an optimal execution
plan because not all arguments of the SQL statement are supplied
at compile time. Depending on the specific database
implementation and configuration, <b>mixed performance results will
be seen from stored procedures versus generic queries</b> or user
defined functions.</li>
</ol>
<p>
Note that there are important <b>disadvantages</b> as well.
</p>

<ol class="org-ol">
<li>
<p>
Stored procedure languages are often vendor-specific. Changing
database vendors usually requires rewriting existing stored
procedures.
</p>

<p>
<i>My comment:</i> interesting that they decided to go so heavily on
them. I think that the lock-up must not be extreme otherwise I
would not imagine them to rely so much on them.
</p>
</li>

<li>
<p>
Changes to stored procedures are harder to keep track of within a
version control system than other code.
</p>

<p>
<i>My comment:</i> This is in fact what the team is complaining
about. There is a single individual that has a good overview of
them and all of the others are masked and if they want to dig
into it is annoying to start reading huge SQL statements that can
be hardly broken apart in which there are parameters embedded.
</p>
</li>
</ol>
<p>
Note that it must be a thing in the DB world the one of working with
DBs.
</p>

<p>
I also heard talking about it in databricks sessions about a company
working with them before switching to databricks.
</p>
</div>
</div>

<div id="outline-container-org98cfe49" class="outline-2">
<h2 id="org98cfe49">On the key refresher</h2>
<div class="outline-text-2" id="text-org98cfe49">
<p>
Recall the basics of relational databses. Nothing new but alternate
keys. Did not recall that definition.
</p>
</div>

<div id="outline-container-org4b97b4a" class="outline-3">
<h3 id="org4b97b4a">Primary Key</h3>
<div class="outline-text-3" id="text-org4b97b4a">
<p>
The <b>primary</b> key is the one that specifies the columns that make a
row entry of the table uniquely identifiable.
</p>
</div>
</div>


<div id="outline-container-org7159b6c" class="outline-3">
<h3 id="org7159b6c">Foreign Key</h3>
<div class="outline-text-3" id="text-org7159b6c">
<p>
A <b>foreign key</b> is a column (or combination of columns) in a table
whose values <i>must match values of a column in some other
table</i>. FOREIGN KEY constraints <i>enforce referential integrity</i>, which
essentially says that if column value A refers to column value B,
then column value B must exist.
</p>

<p>
So say that you have a link between <code>table1.column_a</code> and
<code>table2.column_b</code>. Then if <code>table1.column_a</code> is a foreign key to
<code>table2.column_b</code>, you can just insert <code>table1.column_a</code> if an
existing entry to <code>table2.column_b</code> <i>already exists</i>.
</p>

<p>
In this sense you have this referential integrity and the name
<i>foreign key</i> makes sense. It is a key to some foreign value such
that you can just have an entry for it if the value that is
referenced is existing.
</p>

<p>
You can then see that you can implement some relational logic with
the help of foreign keys. Note that <i>foreign keys</i> <i>can</i> but do not
have to match existing <i>primary keys</i>.
</p>
</div>
</div>


<div id="outline-container-org1c38871" class="outline-3">
<h3 id="org1c38871">Alternate Key / Secondary Keys</h3>
<div class="outline-text-3" id="text-org1c38871">
<p>
In order to understand alternate key, first define what the
<b>candidate key</b> is.
</p>

<p>
<b>candidate key</b> = a set of attributes (columns) that fullfills all
of the criteria to be a primary key.
</p>

<p>
An alternate key, or secondary key is the key that has not been
selected to be the primary key, but are candidate keys.
</p>

<p>
So basically with them you can as well identify unique entries in
the table.
</p>
</div>
</div>
</div>


<div id="outline-container-orge4052ae" class="outline-2">
<h2 id="orge4052ae">Some SQL Notes</h2>
<div class="outline-text-2" id="text-orge4052ae">
<p>
This is fairly standard material. I just was not a too heavy user of
SQL recently, which I have to become again.
</p>
</div>

<div id="outline-container-org0f0571f" class="outline-3">
<h3 id="org0f0571f">Insert Syntax</h3>
<div class="outline-text-3" id="text-org0f0571f">
<p>
Recall inserting syntax
</p>

<div class="highlight"><pre><span></span>   <span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span><span class="p">,</span> <span class="p">...)</span>
   <span class="k">VALUES</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value3</span><span class="p">,</span> <span class="p">...);</span>
</pre></div>
</div>
</div>


<div id="outline-container-orge61a59b" class="outline-3">
<h3 id="orge61a59b">COALESCE()</h3>
<div class="outline-text-3" id="text-orge61a59b">
<p>
COALESCE() function returns the first non-null value in a list.
</p>

<p>
#+begin<sub>src</sub> sql
SELECT COALESCE(NULL, 1, 2, 'W3Schools.com'); – returns 1
#+end_
</p>
</div>
</div>


<div id="outline-container-orgce8fd45" class="outline-3">
<h3 id="orgce8fd45">On Column notation</h3>
<div class="outline-text-3" id="text-orgce8fd45">
<p>
I basically had the same question as <a href="https://stackoverflow.com/questions/52898/what-is-the-use-of-the-square-brackets-in-sql-statements">this guy</a>.
</p>

<p>
So generally you can always use <code>[]</code>. There seems not be
consistency in the team. Both ways are used.
</p>
</div>
</div>


<div id="outline-container-org31a4f37" class="outline-3">
<h3 id="org31a4f37">WITH</h3>
<div class="outline-text-3" id="text-org31a4f37">
<p>
Syntax
</p>

<div class="highlight"><pre><span></span>   <span class="k">WITH</span> <span class="n">query_name1</span> <span class="k">AS</span> <span class="p">(</span>
	<span class="k">SELECT</span> <span class="p">...</span>
	<span class="p">)</span>

   <span class="k">SELECT</span> <span class="p">...</span>
</pre></div>

<p>
So the idea is that you create a query and give it a desired name.
</p>

<p>
You then use the result of such query for running a second query.
</p>

<p>
In such a way you avoid to perform the nasty nested loops.
</p>


<p>
Note that a single with clause can introduce multiple query names
by separating them with a comma
</p>

<div class="highlight"><pre><span></span>   <span class="k">WITH</span> <span class="n">query_name1</span> <span class="k">AS</span> <span class="p">(</span>
	<span class="k">SELECT</span> <span class="p">...</span>
	<span class="p">)</span>
      <span class="p">,</span> <span class="n">query_name2</span> <span class="k">AS</span> <span class="p">(</span>
	<span class="k">SELECT</span> <span class="p">...</span>
	  <span class="k">FROM</span> <span class="n">query_name1</span>
	   <span class="p">...</span>
	<span class="p">)</span>
   <span class="k">SELECT</span> <span class="p">...</span>
</pre></div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../java-notes-history-syntax-and-tricks/" rel="prev" title="Java Notes - History, Syntax and Tricks">Previous post</a>
            </li>
            <li class="next">
                <a href="../emacs-as-java-ide-via-lsp/" rel="next" title="Emacs as Java IDE via LSP">Next post</a>
            </li>
        </ul></nav></aside></article><footer id="footer"><p>Contents © 2021         <a href="mailto:marco.hassan30@gmail.com">Marco Hassan</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(2, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
