<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Database Concepts | Bits of Experience</title>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://marcohassan.github.io/bits-of-experience/posts/database-concepts/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Marco Hassan">
<link rel="prev" href="../switching-language/" title="On some side note about working with Emacs and understanding a different language" type="text/html">
<link rel="next" href="../managing-state-in-cloud-native-applications/" title="Managing State in Cloud Native Applications" type="text/html">
<meta property="og:site_name" content="Bits of Experience">
<meta property="og:title" content="Database Concepts">
<meta property="og:url" content="https://marcohassan.github.io/bits-of-experience/posts/database-concepts/">
<meta property="og:description" content="img {
display: block;
margin-top: 60px;
margin-bottom: 60px;
margin-left: auto;
margin-right: auto;
width: 70%;
height: 100%;
class: center;
}

.container {
  position: relative;
  left: 15%;
  margin">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-02-13T17:11:47+01:00">
<meta property="article:tag" content="Data">
<meta property="article:tag" content="Databases">
</head>
<body>
    <a href="#page-content" class="sr-only sr-only-focusable">Skip to main content</a>
    
    <section class="social"><ul>
<li><a href="../../pages/aboutme/" title="About me"><i class="fa fa-user-circle"></i></a></li>
            <li><a href="../../pages/bits-of-experience-a-readable-view-on-my-study-adventures/" title="Home"><i class="fa fa-home"></i></a></li>
            <li><a href="../../index.html" title="Blog"><i class="fa fa-edit"></i></a></li>
            <li><a href="../../pages/emacs/" title="A life Configuring Emacs"><i class="fa fa-code"></i></a></li>
            <li><a href="../../pages/papers/" title="Term and Research Papers"><i class="fa fa-university"></i></a></li>
            <li><a href="../../pages/foto-blog/" title="Foto Blog"><i class="fa fa-camera-retro"></i></a></li>
            <li><a href="https://github.com/MarcoHassan" title="My Github"><i class="fab fa-github"></i></a></li>
            <li><a href="https://stackoverflow.com/users/9731177/mhass" title="My Stack"><i class="fab fa-stack-overflow"></i></a></li>
            <li><a href="../../rss.xml" title="RSS"><i class="fa fa-rss"></i></a></li>
            <li><a href="../../categories/index.html" title="Tags"><i class="fa fa-tags"></i></a></li>
    
    

        </ul></section><section class="page-content"><div class="content" rel="main">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Database Concepts</a></h1>

        <div class="metadata">
            <p class="dateline"><a href="." rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2022-02-13T17:11:47+01:00" itemprop="datePublished" title="2022-02-13 17:11">2022-02-13 17:11</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                    Marco Hassan
            </span></p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink"><i class="fa fa-file-code"></i> Source</a></p>

            

            
    <div class="tags">
<h3 class="metadata-title">
<i class="fa fa-tags"></i> Tags:</h3>
        <ul itemprop="keywords" class="tags-ul">
<li><a class="tag p-category" href="../../categories/data/" rel="tag">Data</a></li>
            <li><a class="tag p-category" href="../../categories/databases/" rel="tag">Databases</a></li>
        </ul>
</div>

        </div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <style>
img {
display: block;
margin-top: 60px;
margin-bottom: 60px;
margin-left: auto;
margin-right: auto;
width: 70%;
height: 100%;
class: center;
}

.container {
  position: relative;
  left: 15%;
  margin-top: 60px;
  margin-bottom: 60px;
  width: 70%;
  overflow: hidden;
  padding-top: 56.25%; /* 16:9 Aspect Ratio */
  display:block;
  overflow-y: hidden;
}

.responsive-iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border: none;
  display:block;
  overflow-y: hidden;
}
</style>
<p>
So in my new job role there is gonna be quite some SQL so here some
notes on some important DB concepts.
</p>

<p>
Time to refresh, since in the last of couple of years your focus was
not on pure SQL.
</p>

<p>
So for that - what could be better than listening to the <a href="https://www.youtube.com/c/GhislainFournysLectures/playlists">good old
Ghislain</a>?
</p>

<p>
I guess that with a couple of recordings you should have a new correct
mental framework in order to fill up your gaps and that will you put
very high to speed on relational part of the things.. This guy works
at a high level but he does it in a good way that I always enjoyed.
</p>

<!-- TEASER_END -->

<div id="outline-container-org4b8164e" class="outline-2">
<h2 id="org4b8164e">On the key refresher</h2>
<div class="outline-text-2" id="text-org4b8164e">
<p>
Recall the basics of relational databses. Nothing new but alternate
keys. Did not recall that definition.
</p>
</div>

<div id="outline-container-orgacfa0f1" class="outline-3">
<h3 id="orgacfa0f1">Superkey</h3>
<div class="outline-text-3" id="text-orgacfa0f1">
<p>
A subset of attributes <i>S</i> is a superkey if - there is a functional
dependency among all of the other attributes in one table and the
subset of attributes: <i>S</i>.
</p>

<p>
A functional dependency is when the value of an attribute is fully
determined by another one.
</p>

<p>
Formally:
</p>

<img src="../../images/Screenshot%202022-02-10%20162823.png" class="center"><p>
i.e. two values of an attribute which is functionally dependent to
another are equal given that the attribute value which they are
dependent to are equal.
</p>
</div>
</div>

<div id="outline-container-orgbc5f5aa" class="outline-3">
<h3 id="orgbc5f5aa">Candidate Key</h3>
<div class="outline-text-3" id="text-orgbc5f5aa">
<p>
A minimum Superkey.
</p>

<p>
You should reason in terms of candidate keys for your entire
universe.
</p>

<p>
Meaning it should hold <b>for all of the tables</b> in your DB.
</p>
</div>
</div>

<div id="outline-container-org7287e35" class="outline-3">
<h3 id="org7287e35">Closure</h3>
<div class="outline-text-3" id="text-org7287e35">
<p>
Take a set of attributes <i>T</i>.
</p>

<p>
Then you can compute the closure of <i>T</i> by listing all of the
attributes that are functionally determined by the set T.
</p>

<p>
Example with notation:
</p>

<img src="../../images/Screenshot%202022-02-10%20164844.png" class="center">
</div>
</div>

<div id="outline-container-org9c8687f" class="outline-3">
<h3 id="org9c8687f">Minimal Basis</h3>
<div class="outline-text-3" id="text-org9c8687f">
<p>
Is the minimal set <i>R</i> to get to a given closure <i>U</i>.
</p>
</div>
</div>

<div id="outline-container-orgaa32c5f" class="outline-3">
<h3 id="orgaa32c5f">Primary Key</h3>
<div class="outline-text-3" id="text-orgaa32c5f">
<p>
The <b>primary</b> key is the one that specifies the columns that make a
row entry of the table uniquely identifiable.
</p>

<p>
Should be a candidate key.
</p>
</div>
</div>

<div id="outline-container-org9baa4fc" class="outline-3">
<h3 id="org9baa4fc">Foreign Key</h3>
<div class="outline-text-3" id="text-org9baa4fc">
<p>
A <b>foreign key</b> is a column (or combination of columns) in a table
whose values <i>must match values of a column in some other
table</i>. FOREIGN KEY constraints <i>enforce referential integrity</i>, which
essentially says that if column value A refers to column value B,
then column value B must exist.
</p>

<p>
So say that you have a link between <code>table1.column_a</code> and
<code>table2.column_b</code>. Then if <code>table1.column_a</code> is a foreign key to
<code>table2.column_b</code>, you can just insert <code>table1.column_a</code> if an
existing entry to <code>table2.column_b</code> <i>already exists</i>.
</p>

<p>
In this sense you have this referential integrity and the name
<i>foreign key</i> makes sense. It is a key to some foreign value such
that you can just have an entry for it if the value that is
referenced is existing.
</p>

<p>
You can then see that you can implement some relational logic with
the help of foreign keys. Note that <i>foreign keys</i> <i>can</i> but do not
have to match existing <i>primary keys</i>.
</p>
</div>
</div>

<div id="outline-container-org8562a18" class="outline-3">
<h3 id="org8562a18">Alternate Key / Secondary Keys</h3>
<div class="outline-text-3" id="text-org8562a18">
<p>
In order to understand alternate key, first define what the
<b>candidate key</b> is.
</p>

<p>
<b>candidate key</b> = a set of attributes (columns) that fullfills all
of the criteria to be a primary key.
</p>

<p>
An alternate key, or secondary key is the key that has not been
selected to be the primary key, but are candidate keys.
</p>

<p>
So basically with them you can as well identify unique entries in
the table.
</p>
</div>
</div>

<div id="outline-container-org5196a6b" class="outline-3">
<h3 id="org5196a6b">Primary Foreign Key</h3>
<div class="outline-text-3" id="text-org5196a6b">
<p>
Primary Foreign Key (PFK) - key which acts as primary key in more
than one table which occurs in tables with an <b>identifying
relationship</b><sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>.
</p>
</div>
</div>
</div>


<div id="outline-container-orgf24c230" class="outline-2">
<h2 id="orgf24c230">Database Design Theory</h2>
<div class="outline-text-2" id="text-orgf24c230">
<p>
So now that I am starting to design some tables I indeed got back to
the good old  <a href="https://www.youtube.com/c/GhislainFournysLectures/playlists">good old Ghislain</a>.
</p>

<p>
Here some notes.
</p>
</div>

<div id="outline-container-orgef75288" class="outline-3">
<h3 id="orgef75288">Boyce-Codd Normal Form</h3>
<div class="outline-text-3" id="text-orgef75288">
<p>
Work in this way when designing your tables:
</p>

<img src="../../images/Screenshot%202022-02-10%20171016.png" class="center"><p>
Now note the very important bit of it - check at the video and
understand what you are loosing when designing your tables in this
way and what you are getting. Recall the <b>impossibility triangle</b>:
</p>

<div class="container"> 
  <iframe class="responsive-iframe" src="https://www.youtube.com/embed/v=mCIs63sasH4&amp;list=PLs5KPrcFtb0VaveUT-vsBswwl7RWvFeNf&amp;index=22&amp;t=1750s" frameborder="0" allowfullscreen> </iframe>
</div>

<p>
Impossibility triangle:
</p>

<img src="../../images/Screenshot%202022-02-11%20090858.png" class="center"><p>
So note that with broken dependency we mean that when splitting up a
bigger table in order to follow the Boyce-Codd Normal Form we might
loose functional dependencies in the smaller projected tables.
</p>

<p>
Losslessjoin - means that if you join the smaller tables that are
in Boyce-Codd normal form, then if a record existed in the bigger
table it will also exist after joining the smaller tables. 
</p>
</div>
</div>

<div id="outline-container-org2c2689e" class="outline-3">
<h3 id="org2c2689e">Parent-Child relations</h3>
<div class="outline-text-3" id="text-org2c2689e">
<p>
It’s usually used to specify where one table’s value refers to the
value in another table (usually a primary key of another table). 
</p>

<p>
For example, imagine a news article. This could be represented by a
table called articles and has fields for id, headline, body,
published<sub>date</sub> and author. But instead of placing a name in the
author field, you could instead put the ID value of a user in a
separate table—maybe called authors—that has information on authors
such as id, name, and email. 
</p>

<p>
Therefore, if you need to update an author’s name, you only need to
do so in the authors (parent) table; because the articles (child)
table only contains the ID of the corresponding author record.
</p>

<p>
So basically this is a basics principle.
</p>
</div>
</div>
</div>


<div id="outline-container-orga951a0b" class="outline-2">
<h2 id="orga951a0b">Best practices of data modeling</h2>
<div class="outline-text-2" id="text-orga951a0b">
<p>
Start to work with sqlstyle-guides: <a href="https://www.sqlstyle.guide/">see link</a>.
</p>
</div>

<div id="outline-container-orgffda13e" class="outline-3">
<h3 id="orgffda13e">Naming conventions</h3>
<div class="outline-text-3" id="text-orgffda13e">
<ul class="org-ul">
<li>IDs should get an <code>_id</code> suffix, and primary keys should be called
$OBJECT<sub>id</sub> (e.g., order<sub>id</sub>, user<sub>id</sub>, subscription<sub>id</sub>,
order<sub>item</sub><sub>name</sub><sub>id</sub>).</li>

<li>Timestamps should get an <code>_at</code> suffix and dates should get an
<code>_date</code> suffix (e.g., ordered<sub>at</sub> or user<sub>creation</sub><sub>date</sub>).</li>

<li>Booleans should begin with <code>is_</code> or <code>has_</code> (e.g., is<sub>canceled</sub> or
has<sub>discounted</sub><sub>item</sub>).</li>
</ul>
</div>
</div>

<div id="outline-container-orgec5948f" class="outline-3">
<h3 id="orgec5948f">Materialization</h3>
<div class="outline-text-3" id="text-orgec5948f">
<p>
By "materialization" I mean (roughly) whether or not a given
relation is created as a table or as a view.
</p>

<p>
If you create the relation <b>as a table</b>, you precompute any
required calculations, which means that your users will see <b>faster
query response times</b>. If you leave the relation as a view, your
users will get more up-to-date data when they query, but response
times will be slower.
</p>
</div>
</div>

<div id="outline-container-org41ca3e4" class="outline-3">
<h3 id="org41ca3e4">Grain</h3>
<div class="outline-text-3" id="text-org41ca3e4">
<p>
The most important data modeling concept is the grain of a
relation. (I'm using the abstract term "relation" to refer
generically to tables or views.) The grain of the relation defines
what a single row represents in the relation.
</p>

<p>
So basically you are saying what a row is in the DB.
</p>

<p>
You should then call tables as the <i>pluralized version of the
grain</i>.
</p>
</div>
</div>
</div>


<div id="outline-container-org7f1777d" class="outline-2">
<h2 id="org7f1777d">Toad Data Modeler</h2>
<div class="outline-text-2" id="text-org7f1777d">
<p>
So start by checking at <a href="https://help.natureserve.org/biotics/content/DataModel/DM_HowToRead_DataModel.htm">this url</a>.
</p>
</div>

<div id="outline-container-org6e36c11" class="outline-3">
<h3 id="org6e36c11">How to read a table in Toad</h3>
<div class="outline-text-3" id="text-org6e36c11">
<img src="../../images/Screenshot%202022-02-10%20142848.png" class="center"><p>
Note, especially interesting to me is the last column.
</p>

<p>
See there the references to <a href="#org8562a18">Alternate Key / Secondary Keys</a> and
Indices. 
</p>
</div>
</div>


<div id="outline-container-org781314f" class="outline-3">
<h3 id="org781314f">Relations</h3>
<div class="outline-text-3" id="text-org781314f">
<p>
Understand the following few concepts:
</p>

<ul class="org-ul">
<li>
<p>
<code>Identifying relations</code> vs. <code>Non-identifying relations</code>:
</p>

<p>
So this is strictly tight to the concept of <i>primary keys</i> and
<i>primary foreign key</i> - see <a href="#org4b8164e">On the key refresher</a>.
</p>

<p>
The basic idea is that for:
</p>

<ul class="org-ul">
<li>
<p>
for <code>identifying relations</code>
</p>

<p>
you have a primary foreign key relation among the tables. 
</p>
</li>

<li>
<p>
for <code>non-identifying relations</code>
</p>

<p>
you have a primary key for each table and the two tables primary
keys are non-related.
</p>

<p>
However when creating the relation, the primary key of one
table usually becomes an entry - foreign key - of the other
table.
</p>
</li>
</ul>
</li>
</ul>
<p>
This is possibly the most important characteristic.
</p>

<p>
However, note that <a href="https://support.quest.com/technical-documents/toad-data-modeler/6.4/user-guide/25#TOPIC-918537">the following</a> holds in general terms. Check at
it in order to properly define relations. 
</p>
</div>
</div>


<div id="outline-container-orga45f435" class="outline-3">
<h3 id="orga45f435">Reverse Engineer with Toad</h3>
<div class="outline-text-3" id="text-orga45f435">
<p>
Check at <a href="https://blog.toadworld.com/toad-data-modeler-reverse-engineering-convert-model-wizards">this url</a>.
</p>

<p>
Understand that you might have to do it for some databases where no
proper schema was constructed in time.
</p>

<p>
Then you can start organizing the schema.
</p>

<p>
You will have to use it probably sooner or later. No doubt, so
check at it at some point.
</p>

<p>
Note that you have multiple options in here.
</p>
</div>

<div id="outline-container-org58cbb72" class="outline-4">
<h4 id="org58cbb72">
<span class="todo TODO">TODO</span> Completely Reverse Engineer the DB from an existing connection</h4>
</div>

<div id="outline-container-orgdb5f91b" class="outline-4">
<h4 id="orgdb5f91b">Reverse Engineer a DDL schema</h4>
<div class="outline-text-4" id="text-orgdb5f91b">
<p>
This is interesting cause you might well start to check in DDL
into git.
</p>

<p>
Then you will solve this coordination issue.
</p>

<p>
You just have to check in the DDL script every time which is
painful.
</p>

<p>
On the top of it, you might not display the thing as nicely as in
your <code>*.txp</code> file.
</p>

<p>
In order to insert a DDL schema you work as follows:
</p>

<ul class="org-ul">
<li>Open a new workspace. Otherwise it would overwrite your
exisiting solution.</li>

<li>Select <code>Update Model from Database</code> option. See the highlighted
option on the top left of the following Screenshot.</li>
</ul>
<img src="../../images/Screenshot%202022-05-09%20085844.png" class="center"><ul class="org-ul">
<li>
<p>
Select <code>DDL Script RE</code> (ddl script reverse engineer) as data
source.
</p>

<p>
You can then pass the relevant DDL script. It will generate the
relevant data model in the workspace.
</p>

<p>
You can then actually copy and paste such objects into your
workpace of choice. 
</p>
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org5e6418a" class="outline-3">
<h3 id="org5e6418a">
<span class="todo TODO">TODO</span> Merge Models</h3>
<div class="outline-text-3" id="text-org5e6418a">
<p>
This is potentially the solution if it performs a merge among two
different data models in a similar way that git merges conflicts. 
</p>

<p>
You should try this and check how it behaves.
</p>

<p>
Crashing - so not a useful solution.
</p>

<p>
-&gt; Understand what is causing troubles here.
</p>
</div>
</div>


<div id="outline-container-org64e212c" class="outline-3">
<h3 id="org64e212c">Indexes and Constraints</h3>
<div class="outline-text-3" id="text-org64e212c">
<p>
So the part of indexes you can well understand given your recent
study of the relevant bit.
</p>

<p>
Note that the indexes mentioned are similar to the one mentioned on
the Microsoft SQL Server.
</p>

<img src="../../images/Screenshot%202022-02-14%20122328.png" class="center"><p>
Note as well the possibility to impose constraints on your DB
tables.
</p>

<p>
That is of first-order importance and in such a way you can set in
the DB the relevant constraints instead of pushing them to the
application layer.
</p>

<p>
In order to implement such constraints the syntax is the following:
</p>

<div class="highlight"><pre><span></span>    <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
       <span class="p">...,</span>
       <span class="k">CONSTRAINT</span> <span class="k">constraint_name</span> <span class="k">CHECK</span> <span class="p">(</span> <span class="n">predicate</span> <span class="p">),</span>
       <span class="p">...</span>
    <span class="p">)</span>

   <span class="c1">--------------</span>

    <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span>
       <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="k">constraint_name</span> <span class="k">CHECK</span> <span class="p">(</span> <span class="n">predicate</span> <span class="p">)</span>
</pre></div>

<p>
As always you can enter such constraints in Toad and you will be
able to preview the relevant SQL query out of it.    
</p>
</div>

<div id="outline-container-org8020f42" class="outline-4">
<h4 id="org8020f42">
<span class="todo TODO">TODO</span> understand that better. what sql server is the basis for it</h4>
<div class="outline-text-4" id="text-org8020f42">
<p>
cause so far I did not connect it to any databse. so there must be
an issue of a different kind. 
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org48f27bd" class="outline-2">
<h2 id="org48f27bd">Working with Relational Systems</h2>
<div class="outline-text-2" id="text-org48f27bd">
<p>
Views, stored procedures and indices.
</p>

<p>
In general it will be a good choice to take some time and read the
official documentation of the <a href="https://docs.microsoft.com/en-us/sql/relational-databases/graphs/sql-graph-overview?view=sql-server-ver15">Microsoft SQL Server</a>. There you will
find many interesting bits of information such as the graph
capabilities etc.
</p>

<p>
Especially the internals architecture and design might be an
interesting section.
</p>
</div>

<div id="outline-container-orgf33d9f2" class="outline-3">
<h3 id="orgf33d9f2">Indices</h3>
<div class="outline-text-3" id="text-orgf33d9f2">
<p>
Idea you can leverage on this for getting to faster query times.
</p>

<p>
Note that if you want <a href="https://www.youtube.com/watch?v=IhfRbhcC4Ec&amp;list=PLs5KPrcFtb0VaveUT-vsBswwl7RWvFeNf&amp;index=24">this class</a> goes over two of the most basic
indices.
</p>

<p>
You can then find the time yourself to go over the other
indices.
</p>

<p>
Note that you have the following types of indices in Microsoft SQL
Server: <a href="https://docs.microsoft.com/en-us/sql/relational-databases/indexes/indexes?view=sql-server-ver15">indices</a>.
</p>

<p>
Always recall the following trade-off:
</p>

<ul class="org-ul">
<li>if you have and index: writing is slower, cause you will have as
well to update the index. But reading will be much faster if it
can leverage on that index.</li>

<li>and vice versa without index.</li>
</ul>
</div>
</div>


<div id="outline-container-orgf972016" class="outline-3">
<h3 id="orgf972016">Table Views</h3>
<div class="outline-text-3" id="text-orgf972016">
<p>
This is a powerful concepts.
</p>

<p>
The wikipedia definition for it is sufficient to get a basic
understanding of what <i>views</i> are:
</p>

<blockquote>
<p>
A view is the result set of a stored query on the data, which the
database users can query just as they would in a persistent database
collection object.
</p>

<p>
This pre-established query command is kept in the database
dictionary.
</p>

<p>
Unlike ordinary base tables in a relational database, a view does
not form part of the physical schema: as a result set, <b>it is a
virtual table computed or collated dynamically</b> <b>from data in the
database when access to that view is requested</b>. Changes applied to
the data in a relevant underlying table are reflected in the data
shown in subsequent invocations of the view
</p>
</blockquote>

<p>
Views are helpful in the follwoing cases:
</p>

<ul class="org-ul">
<li>can represent a subset of data. can be used for access
permissions. You expose a <i>view</i> to some user without exposing the
entire database.</li>

<li>views can <b>join</b> and simplify <b>multiple tables</b> into a single
virtual table. (note that though the performance will likely still
suffer from the burden of computing the joins each time one of the
underlying queries changes)</li>

<li>you can hide some complexity using views such that is useful for
some other person of your team to work with.</li>

<li>views just take very little space to store. the DB just contains
the definiton of a view and not a copy of all the data that it
presents.</li>
</ul>
<p>
<b>Note</b> that in a similar way to the programming concepts you can
<b>nest</b> views such that you can <i>a view</i> aggregating the information
from multiple views.
</p>

<p>
<b>Note a table is a set:</b> A view is a relational table, and the
relational model defines a table as a set of rows. Since sets are
not ordered — by definition — neither are the rows of a
view. Therefore, an <code>ORDER BY</code> clause in the view definition is
meaningless.
</p>
</div>


<div id="outline-container-org8a50b54" class="outline-4">
<h4 id="org8a50b54">On Updating a view</h4>
<div class="outline-text-4" id="text-org8a50b54">
<p>
<b>Very Important Note - on updating a view</b>: note that if you update a
view you will actually update the underlying <b>persisted</b> table.
Such table will be updated such that your view will ultimately
match your update condition.
</p>

<p>
So this is very important. You cannot only work with views for the
projection exercises and informatin retrieval you need.
</p>

<p>
You can as well use the view in a very neat way for writing and
updating into your DBs.
</p>

<p>
Note that in this sense it might make sense to restrict the view
to allow just specific insert operations.
</p>

<p>
Note as well the following:
</p>

<blockquote>
<p>
If your view is a projection of a subset of attributes from the
underlying table, you will not be able to update the view if the
missing attributes do not accept null values or do not have a default.
</p>

<p>
This because by product such an update would require the attributes to
become nulls and/or fall back to the default values.
</p>
</blockquote>


<p>
Note as well that recursion is not possible in updating a
view. For instance a nested table in the <code>where</code> clause.
</p>
</div>
</div>

<div id="outline-container-org4f37424" class="outline-4">
<h4 id="org4f37424">Materialize Views</h4>
<div class="outline-text-4" id="text-org4f37424">
<p>
You can materialize a view such that it is stored physically on
the disk.
</p>

<p>
It will be must faster query-time then.
</p>

<p>
If you decide to materialize do not forget then to referesh the
materialized view if you update the underlying table.
</p>

<p>
The two will not be in sync if you do not refresh.
</p>

<p>
You should therefore be particularly careful when working with this.
</p>
</div>
</div>
</div>


<div id="outline-container-orgc2ea0e5" class="outline-3">
<h3 id="orgc2ea0e5">Stored Procedures</h3>
<div class="outline-text-3" id="text-orgc2ea0e5">
<p>
So that is probably the big discussion in my larger team.
</p>

<p>
The question is if to keep the business logic into the application
code or into sql-queries.
</p>

<p>
I always embedded my business logic at the application layer
performing the necessary data withdrawl and transformation steps at
the application layer.
</p>

<p>
There is the tendency in my team to use a different approach and to
<i>store the business logic into stored procedures</i>. I am too fresh
into the entire systems of my team to take an informed about the
topic. (Update 11/02 - I see why they do so. Working in languages
as Java for data wrangling is just plain horror)
</p>

<p>
So develop on this and explore the topic further until you can take
an informed position about the topic.
</p>

<p>
Starting with the basic 15 min. research the following picture
emerge.
</p>

<p>
Stored procedures are essentially SQL statements that are saved in
the database <i>data dictionary</i>. You can <b>pass parameters</b> to your
stored procedures. Such parameters will be passed by the client
triggering a stored procedure. It is therefore possible to expose
some business logic in a flexible way through them.<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup></p>

<p>
<b>Note</b> that they do not have to return a table (set of rows) or a
value as in the case of functions and there is in this sense a
difference between the two. You can for instance perform CRUD
operations via stored procedures.
</p>

<p>
Now the arguments that I am reading around in favour of stored
procedures are the following:
</p>

<ol class="org-ol">
<li>
<p>
It can be <b>easily modified</b>: We can easily modify the code inside
the stored procedure without the need to restart or deploying the
application. For example, if the SQL queries are written in the
application and if we need to change the logic, we must change
the code in the application and re-deploy it.
</p>

<p>
That is true for compiled languages and not for scripting
languages. There there is no big difference as I usually develop
keeping a runtime open where I do my on the fly development
running the application logic of interest.
</p>

<p>
Moreover, this sounds like a little benefit to justify the usage
of such stored procedures.
</p>

<p>
—
</p>

<p>
Even for compiled languages the above is crap. See for instance
devtools in Spring. 
</p>
</li>

<li>
<p>
<b>Reduceded Network Traffic</b>: A major advantage of stored
procedures is that they can run directly within the database
engine. They are in fact <b>stored on the DB</b> and from there the
database engine executes them.
</p>

<p>
In a production system, this typically means that the procedures
run entirely on a specialized database server, which has <i>direct
access to the data being accessed</i>. You just ship your parameters
and that is it. The benefit here is that network communication costs can be
avoided completely. <b>This becomes more important for complex
series of SQL statements</b>.
</p>

<p>
As if you have to traffic all of the SQL results back and
forth, make transformations and then run other queries based on
that you see that you quickly get a huge amount of traffic and
everything becomes messy.
</p>

<p>
<i>My Comment:</i> I do see the argument. I am not sure that it is
really the definitive solution. As you are running SQL statements
theoretically you can ship the very same SQL statement via the
application and you can do that in 1 shot so if you structure
things properly you should be able to keep your network bandwidth
safe. 
</p>
</li>

<li>
<p>
<b>Centralized business logic</b>: this point follows directly from
the above. To see this consider the follwoing wording above:
</p>

<p>
<i>They are in fact <b>stored on the DB</b> and from there the database
engine executes them.</i>
</p>

<p>
So this means that you have no chance of having a curropted
client-program logic that was not properly managed across your
software development teams. There is a single source of truth for
the business logic and that reside at the database location.
</p>

<p>
<i>My comment:</i> The strongest argument for me. Probably the one and
only that makes really sense and the ultimate reason for stored
procedures.
</p>

<p>
<i>Note:</i> I even read the following as advantage.
</p>

<blockquote>
<p>
The database system can ensure data integrity and consistency
with the help of stored procedures.
</p>
</blockquote>

<p>
<i>My comment:</i> I think that is very important. Would need some more detailed
explaination of how that would be exactly implemented to make
sense of it in a real way.
</p>
</li>

<li>
<b>Delegating access-rights</b>: In many systems, stored procedures can
be granted access rights to the database that users who execute
those procedures do not directly have.</li>

<li>
<b>Performance:</b> Because stored procedure statements are stored
directly in the database, they may remove all or part of the
compiling overhead that is typically needed in situations where
software applications send inline (dynamic) SQL queries to a
database. (However, most database systems implement statement
caches and other methods to avoid repetitively compiling dynamic
SQL statements.) Also, while they avoid some pre-compiled SQL,
statements add to the complexity of creating an optimal execution
plan because not all arguments of the SQL statement are supplied
at compile time. Depending on the specific database
implementation and configuration, <b>mixed performance results will
be seen from stored procedures versus generic queries</b> or user
defined functions.</li>
</ol>
<p>
Note that there are important <b>disadvantages</b> as well.
</p>

<ol class="org-ol">
<li>
<p>
Stored procedure languages are often vendor-specific. Changing
database vendors usually requires rewriting existing stored
procedures.
</p>

<p>
<i>My comment:</i> interesting that they decided to go so heavily on
them. I think that the lock-up must not be extreme otherwise I
would not imagine them to rely so much on them.
</p>
</li>

<li>
<p>
Changes to stored procedures are harder to keep track of within a
version control system than other code.
</p>

<p>
<i>My comment:</i> This is in fact what the team is complaining
about. There is a single individual that has a good overview of
them and all of the others are masked and if they want to dig
into it is annoying to start reading huge SQL statements that can
be hardly broken apart in which there are parameters embedded.
</p>
</li>
</ol>
<p>
Note that it must be a thing in the DB world the one of working with
DBs.
</p>

<p>
I also heard talking about it in databricks sessions about a company
working with them before switching to databricks.
</p>
</div>

<div id="outline-container-org629c269" class="outline-4">
<h4 id="org629c269">Update 02/05</h4>
<div class="outline-text-4" id="text-org629c269">
<p>
After getting a little bit more on-hands with their system I think
that it is indeed suboptimal to work through such methods.
</p>

<p>
I am quite sure I will put such business logic into the
application.
</p>

<p>
Note that probably they worked as well through them in order to
guarantee ACID transactions.
</p>

<p>
You have as well methods in spring data that can guarantee you
this property.
</p>

<p>
So it really makes little sense to focus so much on this. 
</p>
</div>
</div>
</div>


<div id="outline-container-org8359b96" class="outline-3">
<h3 id="org8359b96">Temp Tables</h3>
<div class="outline-text-3" id="text-org8359b96">
<p>
Check at it <a href="https://www.sqlshack.com/overview-and-performance-tips-of-temp-tables-in-sql-server/">here</a>.
</p>

<p>
This is as well an interesting concept that is at times used in the
team.
</p>

<p>
The essential idea is the following:
</p>

<ul class="org-ul">
<li>You create a table that can perform CRUD operations as other
persistent DB tables.</li>

<li>Temporary tables are dropped when the connection that creates the
table has closed. Otherwise they can be explicitly dropped by
users.</li>
</ul>
<p>
Note that one temp table will be available throughout the
connection.
</p>

<p>
Note that two different connections will create different
temp-tables even if they are called in the same way.
</p>

<p>
See the following concept with postfix
</p>

<img src="../../images/Screenshot%202022-04-29%20095143.png" class="center">
</div>

<div id="outline-container-orge174b92" class="outline-4">
<h4 id="orge174b92">Global temp tables</h4>
<div class="outline-text-4" id="text-orge174b92">
<p>
Note that you can as well create global temp tables that are
accessed by all other connections. 
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org60a3e5d" class="outline-2">
<h2 id="org60a3e5d">On Database Architecture</h2>
<div class="outline-text-2" id="text-org60a3e5d">
</div>
<div id="outline-container-org81020ab" class="outline-3">
<h3 id="org81020ab">Datbase Partitioning</h3>
<div class="outline-text-3" id="text-org81020ab">
<p>
This sections notes are based on: <a href="https://www.digitalocean.com/community/tutorials/understanding-database-sharding">this</a>.
</p>

<p>
In the vertical partition you split by column. In horizontal you
have different tables with the same schema saved over different
instances. So your database is in fact distributed.
</p>

<img src="../../images/db_partitioning.png" class="center">
</div>

<div id="outline-container-org35237d6" class="outline-4">
<h4 id="org35237d6">Database Sharding</h4>
<div class="outline-text-4" id="text-org35237d6">
<p>
Basically as mentioned this is <i>horizontal partitioning</i>.
</p>

<p>
Database shards exemplify a shared-nothing architecture. This means
that the shards are autonomous; they don’t share any of the same data
or computing resources.
</p>

<p>
Oftentimes, sharding is implemented at the <b>application level</b>,
meaning that the application includes code that defines which shard
to transmit reads and writes to. However, some database management
systems have sharding capabilities built in, allowing you to
<i>implement sharding directly at the database level</i>.
</p>

<p>
Note the following <b>reasons for sharding</b>:
</p>

<p>
First and foremost you scale out with it. This is essentially the
idea of the Big Data frameworks that you saw in your multiple
classes at University time. 
</p>

<blockquote>
<p>
Another reason why some might choose a sharded database architecture
is to <b>speed up query response times</b>. When you submit a query on a
database that hasn’t been sharded, it may have to search every row in
the table you’re querying before it can find the result set you’re
looking for. For an application with a large, monolithic database,
queries can become prohibitively slow. By sharding one table into
multiple, though, queries have to go over fewer rows and their result
sets are returned much more quickly.
</p>
</blockquote>

<p>
As a final reason the article mentions this one:
</p>

<blockquote>
<p>
Sharding can also help to make an application more reliable by
mitigating the impact of outages. If your application or website
relies on an unsharded database, an outage has the potential to make
the entire application unavailable. With a sharded database, though,
an outage is likely to affect only a single shard. Even though this
might make some parts of the application or website unavailable to
some users, the overall impact would still be less than if the entire
database crashed.
</p>
</blockquote>

<p>
I mean to be honest I think there are more elegant solutions for
the above. It is a bit a forced point but I list it nonetheless in
here.
</p>

<p>
Note that there are as well quite some concepts as mentioned on the
referred source above that speaks counter the sharding idea.
</p>

<p>
Then for instance one classical sharding possibility is the
following:
</p>

<img src="../../images/db_key_sharding.png" class="center"><p>
Note that the above is just one possibility among the many sharding
possibilities.
</p>
</div>
</div>
</div>


<div id="outline-container-org042c9ea" class="outline-3">
<h3 id="org042c9ea">Linked Servers</h3>
<div class="outline-text-3" id="text-org042c9ea">
<p>
These enable you to implement distributed databases that can fetch
and update data in other databases.
</p>

<p>
They are for instance a good solution in the scenarios where you
need to implement database sharding without need to create a custom
application code or directly load from remote data sources.
</p>

<p>
So basically with them you can do the following:
</p>

<ul class="org-ul">
<li>The ability to access data from outside of SQL Server</li>

<li>
<p>
The ability to issue distributed queries, updates, commands, and
transactions on heterogeneous data sources across the enterprise.
</p>

<p>
Think for instance again to the case of sharding. 
</p>
</li>
</ul>
<p>
Note that the reason why we use this solution as a team is different
but this is another discussion I will not dig too much into.
</p>

<p>
Basically the way you implment this architecture is then the
following:
</p>

<img src="../../images/linked_server.png" class="center"><p>
So understand now that the set up we have at work is a bit
different.
</p>

<p>
It is not 100% the same. You can basically have server-to-server
links and you find these in your data studio under the following
path:
</p>

<ul class="org-ul">
<li>Server Objects -&gt; Linked Servers.</li>
</ul>
<p>
You can then select that object and a databse in it in order to
make these cross-server SQL statements.
</p>
</div>
</div>
</div>


<div id="outline-container-orgbe4d7bb" class="outline-2">
<h2 id="orgbe4d7bb">Some SQL Notes - Language Itself</h2>
<div class="outline-text-2" id="text-orgbe4d7bb">
<p>
This is fairly standard material. I just was not a too heavy user of
SQL recently, which I have to become again.
</p>
</div>

<div id="outline-container-orgc0dd3f6" class="outline-3">
<h3 id="orgc0dd3f6">Set Identity Key - On/Off</h3>
<div class="outline-text-3" id="text-orgc0dd3f6">
<p>
Note that when this is off it basically means that you cannot set
the identity key.
</p>

<p>
Note that with identity key - the primary key is ment.
</p>

<p>
The idea is essentially the following:
</p>

<blockquote>
<p>
The primary key column is often set to auto-increment when
constructing a SQL Server database. The IDENTITY limit is set on for
the primary key column to do this. The starting location and step of
increment are transferred to the IDENTITY column as parameters. Then
whenever a new record is added, and the identity insert is set to OFF,
the value of the IDENTITY column is increased by the pre-defined step
normally a number.  
</p>
</blockquote>

<p>
So set it on or off depending on your needs. And it is obvious that
depending on your choice you will get errors or not if trying to
insert the primary key in an insert statement. 
</p>
</div>
</div>


<div id="outline-container-orge62a144" class="outline-3">
<h3 id="orge62a144">Insert Syntax</h3>
<div class="outline-text-3" id="text-orge62a144">
<p>
Recall inserting syntax
</p>

<div class="highlight"><pre><span></span>   <span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span><span class="p">,</span> <span class="p">...)</span>
   <span class="k">VALUES</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value3</span><span class="p">,</span> <span class="p">...);</span>
</pre></div>
</div>
</div>


<div id="outline-container-org18f3008" class="outline-3">
<h3 id="org18f3008">COALESCE()</h3>
<div class="outline-text-3" id="text-org18f3008">
<p>
COALESCE() function returns the first non-null value in a list.
</p>

<div class="highlight"><pre><span></span>   <span class="k">SELECT</span> <span class="k">COALESCE</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'W3Schools.com'</span><span class="p">);</span> <span class="c1">-- returns 1</span>
</pre></div>
</div>
</div>


<div id="outline-container-orgc9cb6eb" class="outline-3">
<h3 id="orgc9cb6eb">iif</h3>
<div class="outline-text-3" id="text-orgc9cb6eb">
<p>
return <code>YES</code> if condition is <code>True</code> and <code>NO</code> otherwise.
</p>
</div>
</div>


<div id="outline-container-org9cdde61" class="outline-3">
<h3 id="org9cdde61">On Column notation</h3>
<div class="outline-text-3" id="text-org9cdde61">
<p>
I basically had the same question as <a href="https://stackoverflow.com/questions/52898/what-is-the-use-of-the-square-brackets-in-sql-statements">this guy</a>.
</p>

<p>
So generally you can always use <code>[]</code>. There seems not be
consistency in the team. Both ways are used.
</p>
</div>
</div>


<div id="outline-container-orgc1bb2e9" class="outline-3">
<h3 id="orgc1bb2e9">WITH</h3>
<div class="outline-text-3" id="text-orgc1bb2e9">
<p>
Syntax
</p>

<div class="highlight"><pre><span></span>   <span class="k">WITH</span> <span class="n">query_name1</span> <span class="k">AS</span> <span class="p">(</span>
	<span class="k">SELECT</span> <span class="p">...</span>
	<span class="p">)</span>

   <span class="k">SELECT</span> <span class="p">...</span>
</pre></div>

<p>
So the idea is that you create a query and give it a desired name.
</p>

<p>
You then use the result of such query for running a second query.
</p>

<p>
In such a way you avoid to perform the nasty nested loops.
</p>


<p>
Note that a single with clause can introduce multiple query names
by separating them with a comma
</p>

<div class="highlight"><pre><span></span>   <span class="k">WITH</span> <span class="n">query_name1</span> <span class="k">AS</span> <span class="p">(</span>
	<span class="k">SELECT</span> <span class="p">...</span>
	<span class="p">)</span>
      <span class="p">,</span> <span class="n">query_name2</span> <span class="k">AS</span> <span class="p">(</span>
	<span class="k">SELECT</span> <span class="p">...</span>
	  <span class="k">FROM</span> <span class="n">query_name1</span>
	   <span class="p">...</span>
	<span class="p">)</span>
   <span class="k">SELECT</span> <span class="p">...</span>
</pre></div>
</div>
</div>


<div id="outline-container-org8c79a82" class="outline-3">
<h3 id="org8c79a82">Merge</h3>
<div class="outline-text-3" id="text-org8c79a82">
<p>
The MERGE statement is used to make changes in one table based on
values matched from another.
</p>

<p>
This essentially performs <code>insert</code>, <code>update</code>, <code>delete</code> into a
single statement.
</p>

<p>
You can work with a merge statement in the following way:
</p>

<div class="highlight"><pre><span></span>   <span class="n">MERGE</span> <span class="n">targetTable</span>
   <span class="k">Using</span> <span class="n">sourceTable</span>
   <span class="k">ON</span> <span class="n">mergeCondition</span>
   <span class="k">WHEN</span> <span class="n">MATCHED</span>
   <span class="k">THEN</span> <span class="n">updateStatement</span>
   <span class="k">WHEN</span> <span class="k">NOT</span> <span class="n">MATCHED</span> <span class="k">BY</span> <span class="n">TARGET</span>
   <span class="k">THEN</span> <span class="n">insertStatement</span>
   <span class="k">WHEN</span> <span class="k">NOT</span> <span class="n">MATCHED</span> <span class="k">BY</span> <span class="k">SOURCE</span>
   <span class="k">THEN</span> <span class="n">deleteStatement</span>
</pre></div>

<img src="../../images/Screenshot%202022-04-28%20174632.png" class="center"><p>
So you understand that you apply different logic for different
matching statements.
</p>

<p>
Note that when you have a logical wrong condition, for instance
<code>source 1=0</code> then the condition is always fulfilled. This is
sometimes used in combination with merge in order to leverage the
output property. There are restrinctions for it with the insert
statement in this sense. 
</p>
</div>
</div>


<div id="outline-container-org42b95b3" class="outline-3">
<h3 id="org42b95b3">Output</h3>
<div class="outline-text-3" id="text-org42b95b3">
<blockquote>
<p>
The OUTPUT clause returns the values of each row that was affected
by an INSERT, UPDATE or DELETE statements. It even supports with a
MERGE statement, which was introduced in SQL Server 2008 version.
</p>
</blockquote>
</div>
</div>


<div id="outline-container-org2504177" class="outline-3">
<h3 id="org2504177">Update Statement</h3>
<div class="outline-text-3" id="text-org2504177">
<p>
This is the relevant syntax
</p>

<div class="highlight"><pre><span></span>   <span class="k">UPDATE</span> <span class="k">table_name</span>
   <span class="k">SET</span> <span class="n">column1</span> <span class="o">=</span> <span class="n">value1</span><span class="p">,</span> <span class="n">column2</span> <span class="o">=</span> <span class="n">value2</span><span class="p">,</span> <span class="p">...</span>
   <span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</pre></div>
</div>
</div>


<div id="outline-container-org0d2b095" class="outline-3">
<h3 id="org0d2b095">Delete Statement</h3>
<div class="outline-text-3" id="text-org0d2b095">
<div class="highlight"><pre><span></span>   <span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">table_name</span> <span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>
</pre></div>

<p>
Note that the delete keyword is used for deleting rows.
</p>

<p>
If you do not express any condition, then simply all of the rows
are dropped.
</p>

<p>
In order to remove an entire column you rather use the <code>ALTER</code>
statement:
</p>

<div class="highlight"><pre><span></span>   <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">TABLE_NAME</span><span class="o">&gt;</span>
   <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="o">&lt;</span><span class="k">COLUMN_NAME</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
</div>


<div id="outline-container-orgb6751a9" class="outline-3">
<h3 id="orgb6751a9">Alter Statement</h3>
<div class="outline-text-3" id="text-orgb6751a9">
</div>
<div id="outline-container-org23ecbbf" class="outline-4">
<h4 id="org23ecbbf">Columns</h4>
<div class="outline-text-4" id="text-org23ecbbf">
<p>
In such a way it is possible to add, delete or modify columns in an
existing table.
</p>

<div class="highlight"><pre><span></span>    <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span>
    <span class="k">ADD</span> <span class="k">column_name</span> <span class="n">datatype</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgda58918" class="outline-4">
<h4 id="orgda58918">Schema</h4>
<div class="outline-text-4" id="text-orgda58918">
<p>
The alter keyword is used as well for working with the schema of a
DB.
</p>

<p>
I.e. you can transfer tables across tables in such a way.
</p>

<p>
Check at the following example 101:
</p>

<div class="highlight"><pre><span></span>    <span class="cm">/* </span>
<span class="cm">    First create the &lt;SCHEMA&gt; in your DB. </span>

<span class="cm">    I.e. it has to exists or you will get error messages. </span>
<span class="cm">    */</span>

    <span class="k">IF</span> <span class="p">(</span><span class="k">NOT</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">schemas</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'&lt;SCHEMA&gt;'</span><span class="p">))</span> 
    <span class="k">BEGIN</span>
	<span class="k">EXEC</span> <span class="p">(</span><span class="s1">'CREATE SCHEMA [&lt;SCHEMA&gt;] AUTHORIZATION [dbo]'</span><span class="p">)</span>
    <span class="k">END</span>

    <span class="cm">/* </span>
<span class="cm">    Then transfer tables to that &lt;SCHEMA&gt;</span>
<span class="cm">    */</span>

    <span class="k">ALTER</span> <span class="k">SCHEMA</span> <span class="n">NewSchema</span> <span class="n">TRANSFER</span> <span class="p">[</span><span class="n">OldSchema</span><span class="p">].[</span><span class="n">TableName</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>


<div id="outline-container-orge1a8f9d" class="outline-3">
<h3 id="orge1a8f9d">Create</h3>
<div class="outline-text-3" id="text-orge1a8f9d">
<p>
Here the syntax
</p>

<div class="highlight"><pre><span></span>   <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Mytable</span><span class="p">.</span><span class="n">MyName</span> <span class="p">(</span>
       <span class="n">columnName</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
       <span class="n">columnName2</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
       <span class="n">columnName3</span> <span class="nb">float</span>
   <span class="p">);</span>
</pre></div>
</div>
</div>


<div id="outline-container-orgc03e1ca" class="outline-3">
<h3 id="orgc03e1ca">Some lower level stuff - check at what is running in the DB</h3>
<div class="outline-text-3" id="text-orgc03e1ca">
<p>
It will be important at some point to check what is going on with
your database and what you are performing in there at a particular
moment.
</p>

<p>
Got this query somewhere…. not working cause I have no permission
at the moment. Go back to it at some point.
</p>

<div class="highlight"><pre><span></span>   <span class="k">SELECT</span> <span class="n">des</span><span class="p">.</span><span class="n">session_id</span> <span class="p">,</span>
   <span class="n">des</span><span class="p">.</span><span class="n">status</span> <span class="p">,</span>
   <span class="n">OBJECT_NAME</span><span class="p">(</span><span class="n">dest</span><span class="p">.</span><span class="n">objectid</span><span class="p">,</span> <span class="n">der</span><span class="p">.</span><span class="n">database_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">OBJECT_NAME</span> <span class="p">,</span>
   <span class="k">SUBSTRING</span><span class="p">(</span><span class="n">dest</span><span class="p">.</span><span class="nb">text</span><span class="p">,</span> <span class="n">der</span><span class="p">.</span><span class="n">statement_start_offset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
   <span class="p">(</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">der</span><span class="p">.</span><span class="n">statement_end_offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
   <span class="k">THEN</span> <span class="n">DATALENGTH</span><span class="p">(</span><span class="n">dest</span><span class="p">.</span><span class="nb">text</span><span class="p">)</span>
   <span class="k">ELSE</span> <span class="n">der</span><span class="p">.</span><span class="n">statement_end_offset</span>
   <span class="k">END</span> <span class="o">-</span> <span class="n">der</span><span class="p">.</span><span class="n">statement_start_offset</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
   <span class="k">AS</span> <span class="p">[</span><span class="n">executing</span> <span class="k">statement</span><span class="p">]</span> <span class="p">,</span>
   <span class="n">des</span><span class="p">.</span><span class="n">login_name</span> <span class="p">,</span>
   <span class="n">des</span><span class="p">.[</span><span class="n">HOST_NAME</span><span class="p">]</span> <span class="p">,</span>
   <span class="n">der</span><span class="p">.</span><span class="n">blocking_session_id</span> <span class="p">,</span>
   <span class="n">DB_NAME</span><span class="p">(</span><span class="n">der</span><span class="p">.</span><span class="n">database_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">database_name</span> <span class="p">,</span>
   <span class="n">der</span><span class="p">.</span><span class="n">command</span> <span class="p">,</span>
   <span class="n">des</span><span class="p">.</span><span class="n">cpu_time</span> <span class="p">,</span>
   <span class="n">des</span><span class="p">.</span><span class="k">reads</span> <span class="p">,</span>
   <span class="n">des</span><span class="p">.</span><span class="n">writes</span> <span class="p">,</span>
   <span class="nb">dec</span><span class="p">.</span><span class="n">last_write</span> <span class="p">,</span>
   <span class="n">des</span><span class="p">.[</span><span class="n">program_name</span><span class="p">]</span> <span class="p">,</span>
   <span class="n">der</span><span class="p">.</span><span class="n">wait_type</span> <span class="p">,</span>
   <span class="n">der</span><span class="p">.</span><span class="n">wait_time</span> <span class="p">,</span>
   <span class="n">der</span><span class="p">.</span><span class="n">last_wait_type</span> <span class="p">,</span>
   <span class="n">der</span><span class="p">.</span><span class="n">wait_resource</span> <span class="p">,</span>
   <span class="k">CASE</span> <span class="n">des</span><span class="p">.</span><span class="n">transaction_isolation_level</span>
   <span class="k">WHEN</span> <span class="mi">0</span> <span class="k">THEN</span> <span class="s1">'Unspecified'</span>
   <span class="k">WHEN</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="s1">'ReadUncommitted'</span>
   <span class="k">WHEN</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="s1">'ReadCommitted'</span>
   <span class="k">WHEN</span> <span class="mi">3</span> <span class="k">THEN</span> <span class="s1">'Repeatable'</span>
   <span class="k">WHEN</span> <span class="mi">4</span> <span class="k">THEN</span> <span class="s1">'Serializable'</span>
   <span class="k">WHEN</span> <span class="mi">5</span> <span class="k">THEN</span> <span class="s1">'Snapshot'</span>
   <span class="k">END</span> <span class="k">AS</span> <span class="n">transaction_isolation_level</span> <span class="p">,</span>

   <span class="n">deqp</span><span class="p">.</span><span class="n">query_plan</span>
   <span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">dm_exec_sessions</span> <span class="n">des</span>
   <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">sys</span><span class="p">.</span><span class="n">dm_exec_requests</span> <span class="n">der</span>
   <span class="k">ON</span> <span class="n">des</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">der</span><span class="p">.</span><span class="n">session_id</span>
   <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">sys</span><span class="p">.</span><span class="n">dm_exec_connections</span> <span class="nb">dec</span>
   <span class="k">ON</span> <span class="n">des</span><span class="p">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="nb">dec</span><span class="p">.</span><span class="n">session_id</span>
   <span class="k">CROSS</span> <span class="n">APPLY</span> <span class="n">sys</span><span class="p">.</span><span class="n">dm_exec_sql_text</span><span class="p">(</span><span class="n">der</span><span class="p">.</span><span class="n">sql_handle</span><span class="p">)</span> <span class="n">dest</span>
   <span class="k">CROSS</span> <span class="n">APPLY</span> <span class="n">sys</span><span class="p">.</span><span class="n">dm_exec_query_plan</span><span class="p">(</span><span class="n">der</span><span class="p">.</span><span class="n">plan_handle</span><span class="p">)</span> <span class="n">deqp</span>
   <span class="k">where</span> <span class="n">des</span><span class="p">.</span><span class="n">session_id</span> <span class="o">&lt;&gt;</span> <span class="o">@@</span><span class="n">spid</span>
</pre></div>
</div>
</div>


<div id="outline-container-org5ee449e" class="outline-3">
<h3 id="org5ee449e">To see key relations for a column/table</h3>
<div class="outline-text-3" id="text-org5ee449e">
<div class="highlight"><pre><span></span>   <span class="k">SELECT</span>
       <span class="k">TABLE_NAME</span><span class="p">,</span>
       <span class="k">COLUMN_NAME</span><span class="p">,</span>
       <span class="k">CONSTRAINT_NAME</span>
   <span class="k">FROM</span>
       <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">KEY_COLUMN_USAGE</span>
   <span class="k">WHERE</span>
       <span class="k">TABLE_NAME</span> <span class="o">=</span> <span class="s1">'result'</span> <span class="k">AND</span>
       <span class="k">COLUMN_NAME</span> <span class="o">=</span> <span class="s1">'extract'</span>
</pre></div>

<p>
Then you will have a table with all of the relations for that given
table/column.
</p>

<p>
You can then check at all of the tables/columns affected by a given
key constraint.
</p>
</div>
</div>

<div id="outline-container-org2b3e0ec" class="outline-3">
<h3 id="org2b3e0ec">Working with primary keys and their respective constrains</h3>
<div class="outline-text-3" id="text-org2b3e0ec">
<p>
Example for creating a primary key spanning multiple columns
</p>

<div class="highlight"><pre><span></span>   <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">map</span><span class="p">.</span><span class="n">Factor_Schema</span>
   <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">PK_FactorSchema</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ru_code</span><span class="p">,</span><span class="n">barraid_factor_cs</span><span class="p">);</span>
</pre></div>

<p>
Example for removing a specific constraint from the DB. Does not
necessarily have to be a primary key constraint.
</p>

<div class="highlight"><pre><span></span>   <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">map</span><span class="p">.</span><span class="n">Factor_Schema</span>
   <span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">PK_FactorSchema</span>
</pre></div>
</div>
</div>


<div id="outline-container-orgce4f19e" class="outline-3">
<h3 id="orgce4f19e">Some useful sql snippets</h3>
<div class="outline-text-3" id="text-orgce4f19e">
<p>
These will pose some very basic queries and concepts that you will
have to use continuously… I do not like to continuously do the
double of the effort.
</p>

<p>
So will store here the basic stuff and just perform a copy and
paste exercise when necessary.
</p>
</div>

<div id="outline-container-org433dca4" class="outline-4">
<h4 id="org433dca4">Check that two tables are equal</h4>
<div class="outline-text-4" id="text-org433dca4">
<p>
Starting to get back the sql skills.
</p>

<p>
Check for instance at the following.
</p>

<p>
You can use the following as a snippet to check that two tables are
no different from each other. 
</p>

<div class="highlight"><pre><span></span>    <span class="k">select</span> <span class="n">mark</span><span class="p">.</span><span class="o">*</span>  <span class="c1">-- select the different one.</span>
		    <span class="c1">-- the general idea is the following:</span>
		    <span class="c1">--   1. get all of rows where you have a match for the specified columns (see join)</span>
		    <span class="c1">--   2. make a full outer join on the results of 1. and check which record are null</span>
		    <span class="c1">--      meaning there was not a match. </span>

    <span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span>
	  <span class="k">from</span> <span class="n">B1_M21</span><span class="p">.</span><span class="n">mac</span><span class="p">.</span><span class="n">barra_factors</span>
	  <span class="k">where</span> <span class="k">version</span> <span class="o">=</span> <span class="mi">92</span><span class="p">)</span>  <span class="k">as</span> <span class="n">mark</span>
    <span class="k">full</span> <span class="k">outer</span> <span class="k">join</span> <span class="p">(</span>
	<span class="c1">-- here you check that you have a match for the columns of interest</span>
	<span class="c1">-- in the two tables marco and mark.</span>
	<span class="k">select</span> <span class="o">*</span>
	<span class="k">from</span> <span class="n">B1_M21</span><span class="p">.</span><span class="k">result</span><span class="p">.</span><span class="n">Factor_Loading</span> 
	<span class="k">where</span> <span class="n">as_of_version</span> <span class="o">=</span> <span class="mi">11</span>
	<span class="p">)</span>  <span class="k">on</span>    <span class="n">m</span><span class="p">.</span><span class="n">barra_security</span>   <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="k">security</span>
		 <span class="k">and</span>   <span class="n">m</span><span class="p">.</span><span class="n">factor</span>          <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">credit_factor</span>
		 <span class="k">and</span>   <span class="n">m</span><span class="p">.</span><span class="n">value</span>           <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">coefficient</span>
	<span class="k">where</span> <span class="p">(</span><span class="n">mark</span><span class="p">.</span><span class="n">credit_factor</span> <span class="k">is</span> <span class="k">null</span>
	       <span class="k">or</span> <span class="n">marco</span><span class="p">.</span><span class="n">factor</span> <span class="k">is</span> <span class="k">null</span><span class="p">)</span> <span class="c1">-- note that not even this is perfect.</span>
					<span class="c1">-- just checking if there was not a match on these.</span>
					<span class="c1">-- so would have to check also at the other ones..</span>
					<span class="c1">-- double check next time you will properly use it.</span>
</pre></div>
</div>
</div>
</div>


<div id="outline-container-orgf8b43ff" class="outline-3">
<h3 id="orgf8b43ff">Bit</h3>
<div class="outline-text-3" id="text-orgf8b43ff">
<p>
Note that this is a very particular data type.
</p>

<p>
The idea is that it can be either <code>0</code> or <code>1</code>.
</p>

<p>
But note the tricky part of it. If you insert numbers higher than
<code>1</code>, it does not raise an error. It simply enters 1.
</p>

<p>
In this sense if you would like to have a proper boolean variable
with quality control you would have to insert a constraints in your
DB to check for it. 
</p>
</div>
</div>



<div id="outline-container-org3d32035" class="outline-3">
<h3 id="org3d32035">Raising Errors</h3>
<div class="outline-text-3" id="text-org3d32035">
<p>
So we have a heavy user of stored procedures in the team.
</p>

<p>
So he puts a lot of the business logic in SQL.
</p>

<p>
So there are stored procedures performing the relevant bit of the
application logic.
</p>

<p>
Now note that these stored procedures hold difficult business
logic.
</p>

<p>
Say for instance:
</p>

<ul class="org-ul">
<li>declaring interim tables</li>

<li>try catch expressions raising errors</li>
</ul>
<p>
etc.
</p>

<p>
On the last one you need to understand a bit the logic of the error
messages.
</p>

<p>
This is all the info you have at times. But the developer is giving
you some info if you understand that error messages.
</p>

<p>
Apart from the message itself that is not always 100% exhaustive -
you have the severity number. 
</p>

<div class="highlight"><pre><span></span>   <span class="n">RAISERROR</span> <span class="p">(</span><span class="n">N</span><span class="s1">'This is message %s %d.'</span><span class="p">,</span> <span class="c1">-- Message text.  </span>
	      <span class="mi">10</span><span class="p">,</span> <span class="c1">-- Severity,  </span>
	      <span class="mi">1</span><span class="p">,</span> <span class="c1">-- State,  </span>
	      <span class="n">N</span><span class="s1">'number'</span><span class="p">,</span> <span class="c1">-- First argument.  </span>
	      <span class="mi">5</span><span class="p">);</span> <span class="c1">-- Second argument.  </span>
   <span class="c1">-- The message text returned is: This is message number 5.  </span>
</pre></div>

<p>
That is important as it gives you an idea about who should be
informed about what. 
</p>
</div>
</div>


<div id="outline-container-org87100b0" class="outline-3">
<h3 id="org87100b0">All of the different types of joins</h3>
<div class="outline-text-3" id="text-org87100b0">
<p>
Finally, decided to quickly write a note for it. The issue is the
following, you have the following visualization. You always forget
how to read it.
</p>

<p>
I periodically learn it and then after a while I do not recall it.
</p>

<p>
It is quite simple. Making an example here with left join such that
you will never waste any time with it anymore.
</p>

<p>
Basically the idea is the following:
</p>

<img src="../../images/Screenshot%202022-05-04%20165746.png" class="center"><p>
So basically the difference is the following:
</p>

<p>
left-join: you keep all of the data from the left-side - i.e. the
<b>table you are joining</b>. This independently if there is a match or
not.
</p>

<p>
All of the attributes of the table you are joining with are null,
just if there is a matching, then you will have an equality
relation and you will be able to access the values for the attributes. 
</p>

<p>
If there is no matching the selected fields of the other table are
set to null.
</p>

<p>
And in a similar way you interpret all of the other relations in
there.
</p>
</div>
</div>


<div id="outline-container-orga703140" class="outline-3">
<h3 id="orga703140">How to copy a table from one database to another one</h3>
<div class="outline-text-3" id="text-orga703140">
<p>
This is another very simple schema
</p>

<div class="highlight"><pre><span></span>   <span class="k">Create</span> <span class="k">schema</span> <span class="n">HumanResources</span>
   <span class="k">Go</span>

   <span class="k">Select</span> <span class="o">*</span> <span class="k">into</span> <span class="n">SQLShackDemo</span><span class="p">.</span><span class="n">HumanResources</span><span class="p">.</span><span class="n">Department</span> <span class="k">from</span> 
   <span class="n">AdventureWorks2018</span><span class="p">.</span><span class="n">HumanResources</span><span class="p">.</span><span class="n">Department</span> 
</pre></div>
</div>
</div>


<div id="outline-container-orgb31342e" class="outline-3">
<h3 id="orgb31342e">INFORMATION<sub>SCHEMA</sub>
</h3>
<div class="outline-text-3" id="text-orgb31342e">
<p>
This is as well interesting.
</p>

<p>
Check at the following: <a href="https://chartio.com/learn/databases/using-information-schema-views-to-check-to-see-if-table-exists-in-sql-server/">here</a>.   
</p>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef">
<sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup><div class="footpara"><p class="footpara">
An identifying relationship is a relationship between two
entities in which an instance of a child entity is identified through
its association with a parent entity, which means the child entity is
dependent on the parent entity for its identity and cannot exist
without it. 
</p></div>
</div>

<div class="footdef">
<sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup><div class="footpara"><p class="footpara">
Note as well that here is the big difference with Views. In
views you cannot pass any paramters. 
</p></div>
</div>


</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../switching-language/" rel="prev" title="On some side note about working with Emacs and understanding a different language">Previous post</a>
            </li>
            <li class="next">
                <a href="../managing-state-in-cloud-native-applications/" rel="next" title="Managing State in Cloud Native Applications">Next post</a>
            </li>
        </ul></nav></aside></article><footer id="footer"><p>Contents © 2022         <a href="mailto:marco.hassan30@gmail.com">Marco Hassan</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(2, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
