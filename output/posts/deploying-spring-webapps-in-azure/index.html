<!DOCTYPE html>
<html prefix="        og: http://ogp.me/ns# article: http://ogp.me/ns/article#     " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Deploying Spring Webapps in Azure | Bits of Experience</title>
<link href="https://fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://marcohassan.github.io/bits-of-experience/posts/deploying-spring-webapps-in-azure/">
<!--[if lt IE 9]><script src="../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><meta name="author" content="Marco Hassan">
<link rel="prev" href="../macro-variables/" title="Macro Variables" type="text/html">
<link rel="next" href="../azure-pipelines/" title="Azure Pipelines" type="text/html">
<meta property="og:site_name" content="Bits of Experience">
<meta property="og:title" content="Deploying Spring Webapps in Azure">
<meta property="og:url" content="https://marcohassan.github.io/bits-of-experience/posts/deploying-spring-webapps-in-azure/">
<meta property="og:description" content="So starting to make a little bit of order and starting to deploy
directly to Azure.



That is nothing fancy at all. Just basics stuff. With it you can start
to properly experiment in your Sandbox. 

">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-03-21T16:34:55+01:00">
<meta property="article:tag" content="azure">
<meta property="article:tag" content="software-engineering">
</head>
<body>
    <a href="#page-content" class="sr-only sr-only-focusable">Skip to main content</a>
    
    <section class="social"><ul>
<li><a href="../../pages/aboutme/" title="About me"><i class="fa fa-user-circle"></i></a></li>
            <li><a href="../../pages/bits-of-experience-a-readable-view-on-my-study-adventures/" title="Home"><i class="fa fa-home"></i></a></li>
            <li><a href="../../index.html" title="Blog"><i class="fa fa-edit"></i></a></li>
            <li><a href="../../pages/emacs/" title="A life Configuring Emacs"><i class="fa fa-code"></i></a></li>
            <li><a href="../../pages/papers/" title="Term and Research Papers"><i class="fa fa-university"></i></a></li>
            <li><a href="../../pages/foto-blog/" title="Foto Blog"><i class="fa fa-camera-retro"></i></a></li>
            <li><a href="https://github.com/MarcoHassan" title="My Github"><i class="fab fa-github"></i></a></li>
            <li><a href="https://stackoverflow.com/users/9731177/mhass" title="My Stack"><i class="fab fa-stack-overflow"></i></a></li>
            <li><a href="../../rss.xml" title="RSS"><i class="fa fa-rss"></i></a></li>
            <li><a href="../../categories/index.html" title="Tags"><i class="fa fa-tags"></i></a></li>
    
    

        </ul></section><section class="page-content"><div class="content" rel="main">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Deploying Spring Webapps in Azure</a></h1>

        <div class="metadata">
            <p class="dateline"><a href="." rel="bookmark"><i class="fa fa-clock"></i> <time class="published dt-published" datetime="2022-03-21T16:34:55+01:00" itemprop="datePublished" title="2022-03-21 16:34">2022-03-21 16:34</time></a></p>
            <p class="byline author vcard"> <i class="fa fa-user"></i> <span class="byline-name fn" itemprop="author">
                    Marco Hassan
            </span></p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink"><i class="fa fa-file-code"></i> Source</a></p>

            

            
    <div class="tags">
<h3 class="metadata-title">
<i class="fa fa-tags"></i> Tags:</h3>
        <ul itemprop="keywords" class="tags-ul">
<li><a class="tag p-category" href="../../categories/azure/" rel="tag">azure</a></li>
            <li><a class="tag p-category" href="../../categories/software-engineering/" rel="tag">software-engineering</a></li>
        </ul>
</div>

        </div>
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>
So starting to make a little bit of order and starting to deploy
directly to Azure.
</p>

<p>
That is nothing fancy at all. Just basics stuff. With it you can start
to properly experiment in your Sandbox. 
</p>

<!-- TEASER_END -->

<div id="outline-container-org05b86a2" class="outline-2">
<h2 id="org05b86a2">Choosing the right subscription</h2>
<div class="outline-text-2" id="text-org05b86a2">
<p>
Ok so had a little bit of an hiccup at the beginning. Could not find
the new subscription to the sandbox environment I could get for
experimenting on the cloud.
</p>

<p>
Turns out that I had to make a new login to my account. With the
previous login there was no update.
</p>

<p>
Weird stuff.
</p>

<p>
Anyways after doing that I could see both of my subscriptions - to
the secure env and to the sandbox
</p>

<div class="highlight"><pre><span></span>  az account list -o table
</pre></div>

<p>
Now it is possible to specify the subscriptionId of that table and
the resource group and directly set up stuff over there.  
</p>
</div>
</div>

<div id="outline-container-org5d86762" class="outline-2">
<h2 id="org5d86762">Choosing the runtime</h2>
<div class="outline-text-2" id="text-org5d86762">
<p>
So the first thing is to choose the right config for your
applications.
</p>

<p>
You can check at the available runtimes with the following:
</p>

<div class="highlight"><pre><span></span>  az webapp list-runtimes --os linux <span class="p">|</span> grep <span class="s2">"JAVA\|TOMCAT\|JBOSSEAP"</span>
</pre></div>

<p>
Interesting is that there is for instance no <code>Jetty</code> server. Given
your recent exploration into async programming and the power of such
server in that dimension I am struck that azure did not offer such
an option yet.
</p>

<p>
Note that different runtimes need different packaging of the
underlying bytecode. 
</p>
</div>
</div>

<div id="outline-container-org8b185f8" class="outline-2">
<h2 id="org8b185f8">One Good tool to monitor your application - Kudu</h2>
<div class="outline-text-2" id="text-org8b185f8">
<p>
This is an open source project you would need to understand more if
you will work a lot with webapps.
</p>

<p>
You can read it over <a href="https://azure.microsoft.com/en-us/blog/windows-azure-websites-online-tools-you-should-know-about/">here</a>. Or <a href="https://docs.microsoft.com/en-us/azure/app-service/resources-kudu">here</a>. And <a href="https://github.com/projectkudu/kudu/wiki">here</a>.
</p>

<p>
Note that when deploying your apps there is always a runtime of such
Kudu suite. You can understand better how to work with it.
</p>

<p>
To this stage I just understand that this is a project that makes it
possible to manage and monitor your webapps.
</p>

<p>
In this sense the Kudu API that is often mentioned as a possibility
on the microsoft webpage is interacting with that deployed project
that will steer your app.
</p>

<p>
See for instance <a href="https://docs.microsoft.com/en-us/azure/app-service/configure-language-java?pivots=platform-linux#starting-jar-apps">here</a>. You see that you are actually deploying your
war to that endpoint. There a bit of magic must also happen.
</p>

<p>
<b>Note</b> there you have as well a bash shell which has a much higher
response time in comparison to the ssh option.
</p>
</div>
</div>

<div id="outline-container-org11663cd" class="outline-2">
<h2 id="org11663cd">Gradle Deployment</h2>
<div class="outline-text-2" id="text-org11663cd">
<p>
There is a nice plug-in in both gradle and maven that will handle
the deployment and set up of webapps resources.
</p>

<p>
You can check it <a href="https://docs.microsoft.com/en-us/azure/app-service/configure-language-java?pivots=platform-linux#deploying-your-app">here</a>.
</p>

<p>
Then basically through the plug-in you will have a new command that
will create your webapp with the given specifications of your
choice.
</p>

<div class="highlight"><pre><span></span>  <span class="n">azurewebapp</span> <span class="p">{</span>
      <span class="n">subscription</span> <span class="o">=</span> <span class="err">'</span><span class="o">&lt;</span><span class="n">your</span> <span class="n">subscription</span> <span class="n">id</span><span class="o">&gt;</span><span class="err">'</span>
      <span class="n">resourceGroup</span> <span class="o">=</span> <span class="err">'</span><span class="o">&lt;</span><span class="n">your</span> <span class="n">resource</span> <span class="n">group</span><span class="o">&gt;</span><span class="err">'</span>
      <span class="n">appName</span> <span class="o">=</span> <span class="err">'</span><span class="o">&lt;</span><span class="n">your</span> <span class="n">app</span> <span class="n">name</span><span class="o">&gt;</span><span class="err">'</span>
      <span class="n">pricingTier</span> <span class="o">=</span> <span class="err">'</span><span class="o">&lt;</span><span class="n">price</span> <span class="n">tier</span> <span class="n">like</span> <span class="err">'</span><span class="n">P1v2</span><span class="sc">'&gt;'</span> <span class="c1">// check here https://azure.microsoft.com/en-us/pricing/details/app-service/linux/#purchase-options</span>
      <span class="n">region</span> <span class="o">=</span> <span class="err">'</span><span class="o">&lt;</span><span class="n">region</span> <span class="n">like</span> <span class="err">'</span><span class="n">westus</span><span class="sc">'&gt;'</span> <span class="c1">// view locations with az account list-locations -o table</span>
      <span class="n">runtime</span> <span class="p">{</span>
	<span class="n">os</span> <span class="o">=</span> <span class="err">'</span><span class="n">Linux</span><span class="err">'</span>
	<span class="n">webContainer</span> <span class="o">=</span> <span class="err">'</span><span class="n">Tomcat</span> <span class="mf">9.0</span><span class="err">'</span>     <span class="c1">// or 'Java SE' if you want to run an executable jar</span>
	<span class="n">javaVersion</span> <span class="o">=</span> <span class="err">'</span><span class="n">Java</span> <span class="mi">8</span><span class="err">'</span>
      <span class="p">}</span>
      <span class="c1">// appSettings {</span>
      <span class="c1">//     &lt;key&gt; = &lt;value&gt;               // here you can pass specific parameter settings for your application</span>
      <span class="c1">// }</span>
      <span class="n">auth</span> <span class="p">{</span>
	  <span class="n">type</span> <span class="o">=</span> <span class="err">'</span><span class="n">azure_cli</span><span class="err">'</span>            <span class="c1">// support azure_cli, oauth2, device_code and service_principal</span>
      <span class="p">}</span>
  <span class="p">}</span>
</pre></div>

<p>
Good.
</p>

<p>
Note that in general the above is good but should be now embedded in
a bigger devOps logic. Otherwise it makes little sense.
</p>

<p>
The other option is to abstract in the DevOps from all of this. Just
create a proper environment with all of the relevant
resources. Deploy then to that targeted resources. 
</p>

<p>
Anyways that is a different topic that will just come in time. Back
to it. Will be useful in any case for my sandbox env. I will have to
decide soon how I want to work over there.
</p>

<p>
Now there is a bit of a distinction you have to do depending on the
server you are using for your deployment.
</p>
</div>

<div id="outline-container-org3882747" class="outline-3">
<h3 id="org3882747">JAVA SE</h3>
<div class="outline-text-3" id="text-org3882747">
<p>
This should be the way to run SpringBoot on Linux. It is clearly
stated by one person of the App service team on the Microsoft
blogs.
</p>

<p>
See <a href="https://social.msdn.microsoft.com/Forums/azure/en-US/fe9e80d4-7263-46d4-891c-bf38ca4fcc25/azure-webapp-http-status-404-8211-not-found?forum=windowsazurewebsitespreview">here</a>.
</p>

<p>
So start to work through such server if there is no strong point
for continuing along the way of TOMCAT.
</p>

<p>
Would need to talk with the team.
</p>

<p>
If you work with such server everything is straightforward; you
just
</p>

<div class="highlight"><pre><span></span>   gradle azureWebAppDeploy
</pre></div>

<p>
and badaboom. Everything will work smoothly.
</p>

<p>
Your application is converted to an <code>app.jar</code> in
<code>/home/site/wwwroot</code> and everything will be unpackaged and run
correctly.
</p>

<p>
It just may take a while.
</p>
</div>
</div>


<div id="outline-container-orgdfe2d70" class="outline-3">
<h3 id="orgdfe2d70">TOMCAT</h3>
<div class="outline-text-3" id="text-orgdfe2d70">
<p>
So here the thing is a bit different as your TOMCAT reads and works
with <code>.war</code>.
</p>

<p>
So the first step is to build a <code>.war</code> and pass it to the TOMCAT
within the WebApp in the proper way. 
</p>

<p>
Note now that if you deploy a Spring application things are slightly
more tricky.
</p>

<p>
This is because by default Spring packages everything into a
<code>.jar</code>. You can then execute that <code>.jar</code> in gradle via the standard
</p>

<div class="highlight"><pre><span></span>   ./gradlew.bat bootRun
</pre></div>

<p>
If you want to understand more about that concept check at your
notes <a href="https://marcohassan.github.io/bits-of-experience/posts/spring/">here</a> in the deployment section.
</p>

<p>
Now understand that under the hood when you deploy with the plug-in
above the thing will not simply start the server but will start as
well to deploy the artifact of your application.
</p>

<p>
Now understand that the TOMCAT server is set up to deploy
applications packaged as <code>.war</code> not as <code>.jar</code>.
</p>

<p>
In this sense is of paramount importance when deploying spring
applications to apply as well the <code>war</code> plugin such that everything
will be packaged as a <code>war</code> in the correct default location and your
webapp with your TOMCAT runtime can boot the application correctly.
</p>

<div class="highlight"><pre><span></span>   <span class="n">plugins</span> <span class="p">{</span>

       <span class="c1">// Spring Plug-ins</span>
       <span class="n">id</span> <span class="err">'</span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">boot</span><span class="err">'</span> <span class="n">version</span> <span class="err">'</span><span class="mf">2.4.2</span><span class="err">'</span>
       <span class="n">id</span> <span class="err">'</span><span class="n">io</span><span class="p">.</span><span class="na">spring</span><span class="p">.</span><span class="na">dependency</span><span class="o">-</span><span class="n">management</span><span class="err">'</span> <span class="n">version</span> <span class="err">'</span><span class="mf">1.0.11</span><span class="p">.</span><span class="na">RELEASE</span><span class="err">'</span>

       <span class="n">id</span> <span class="err">'</span><span class="n">java</span><span class="err">'</span>
       <span class="n">id</span> <span class="err">'</span><span class="n">war</span><span class="err">'</span>  <span class="c1">// very important</span>

       <span class="c1">// Microsoft Webapp Plug-in</span>
       <span class="n">id</span> <span class="s">"com.microsoft.azure.azurewebapp"</span> <span class="n">version</span> <span class="s">"1.2.0"</span>
   <span class="p">}</span>
</pre></div>

<p>
Then with it you can deploy your application in the following way
</p>

<div class="highlight"><pre><span></span>   gradle azureWebAppDeploy
</pre></div>

<p>
Note that in such a case you deploy a <code>.war</code> to the
<code>/home/site/wwwroot</code>.
</p>

<p>
So not good enough as you should live in the
<code>/home/site/wwwroot/webapps</code>.
</p>

<p>
Check now the following testing etc.
</p>
</div>
</div>

<div id="outline-container-orge0095b8" class="outline-3">
<h3 id="orge0095b8">
<span class="todo TODO">TODO</span> open issues</h3>
<div class="outline-text-3" id="text-orge0095b8">
<p>
Not working correctly. The application seems to be deployed but I
cannot hit the endpoint. Get 404 error.
</p>

<p>
See the <a href="https://social.msdn.microsoft.com/Forums/azure/en-US/fe9e80d4-7263-46d4-891c-bf38ca4fcc25/azure-webapp-http-status-404-8211-not-found?forum=windowsazurewebsitespreview">following issue</a>. This actually put me off the road. Weird
stuff…. should work according to my mind.
</p>

<p>
So not clear to this stage.
</p>

<p>
This is a bit what happens in my team. No idea where to put the
<code>.war</code> so weird pipelines are being created that finally reproduce
the structure of a TOMCAT.
</p>

<p>
You could then force everything in a similar way along these lines
by following the thing over <a href="https://www.baeldung.com/spring-boot-war-tomcat-deploy">here</a>.
</p>

<p>
What is weird that in such a case you are not leveraging the magic
of PaaS and for what is worth you could then well go for IaaS in
this sense.
</p>

<p>
So makes totally no sense.
</p>

<p>
So will need to fix that at some point when the right moment will
come. 
</p>

<p>
Giving up for now as it is taking too much time and I have to move
on with other work. Posted a Question on StackOverflow. Try to
check what answers you get over there. <a href="https://stackoverflow.com/questions/71584566/deploying-a-war-on-azure-webapps-tomcat-server">Monitor it</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-org2cd5073" class="outline-2">
<h2 id="org2cd5073">Understand pricing tiers in Azure</h2>
<div class="outline-text-2" id="text-org2cd5073">
<p>
How are they constrcuted? What are the specifics?
</p>

<p>
You can find them <a href="https://azure.microsoft.com/en-us/pricing/details/app-service/windows/">here</a>.
</p>

<p>
Now for testing on the sandbox env that I finally managed to get you
can go with the free tier without any issue.
</p>

<p>
In any case should you in the future need an overview you can check
there cause it is not convenient to fake the mock creation via
web-UI and then exploring there.
</p>

<p>
Note as well <a href="https://docs.microsoft.com/en-us/answers/questions/285699/is-there-a-way-to-get-the-sku-for-a-list-of-web-ap.html">the following option</a> if you want to do that via CLI as
you mostly work and live in there.
</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../macro-variables/" rel="prev" title="Macro Variables">Previous post</a>
            </li>
            <li class="next">
                <a href="../azure-pipelines/" rel="next" title="Azure Pipelines">Next post</a>
            </li>
        </ul></nav></aside></article><footer id="footer"><p>Contents © 2022         <a href="mailto:marco.hassan30@gmail.com">Marco Hassan</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </section><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(2, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
